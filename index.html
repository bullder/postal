<!DOCTYPE html>
<html lang="en">
<head>
	<title>Shower Presentation Engine</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="shower/themes/ribbon/styles/styles.css">
	<style>
        .shower {
            --slide-ratio: calc(16 / 9);
        }

		#precover {
			padding: 200px 0 0 400px;
		}

		#cover h2 {
				margin: 30px 0 0;
				color: white;
				text-align: center;
				font-size: 70px;
		}

		#cover p {
			margin: 10px 0 0;
			text-align: center;
			color: white;
			font-style: italic;
			font-size: 20px;
		}

		#cover p a {
			color: white;
		}

		#cover {
			padding-top: 40%;
		}

		#precover:after, #cover:after, #picture:after {
			display: none;
		}

		.shower {
			font-size: 120%;
		}
    </style>
</head>
<body class="shower list">

	<header class="caption">
		<h1>Going postal</h1>
		<p>Yours Michael Garifullin, Smartbox Group.</p>
	</header>

	<section class="slide" id="precover">
			<h2>Going postal</h2>
			<p>
				messaging the past, present and hopes<br />
				Michael Garifullin - 13/07/2018
			</p>
			<figure>
				<img class="cover" src="pictures/cover.png" alt="Going postal">
				<figcaption class="copyright right white">
					<a href="http://smartbox.com/">© Smartbox</a>
				</figcaption>
			</figure>
			<style>
	
			</style>
		</section>

	<section class="slide" id="cover">
		<figure>
			<img class="cover" src="pictures/cover.jpg" alt="Going postal">
		</figure>
		<style>

		</style>
	</section>

	<section class="slide">
		<h2>How it was</h2>
		<ol>
			<li>Function-style call to send something</li>
			<li>JarvisBooking\Mailer->sendCancellationEmail
				<ul>
					<li>Resolve channel of notification, adjust presentation regaring that</li>
					<li>Collect data</li>
					<li>Render twig</li>
				</ul>
			</li>
			<li>Common email sending stuff
				<ul>
					<li>Wrap it to Swift_Message</li>
					<li>We're responsible for delivering</li>
				</ul>
			</li>
			<li>Logging and error handling</li>
		</ol>
	</section>

	<section class="slide">
		<h2>How it is</h2>
		<ol>
			<li>Fire event that something happened.</li>
			<li>espBundle->EmailFactory->createNew()
				<ul>
					<li>Resolve campaingId for notification</li>
					<li>Collect array data</li>
					<li><s>Render twig</s></li>
				</ul>
			</li>
			<li>espBundle->SenderInterface->send()
				<ol>
					<li>Send serialized array to external service with POST request</li>
					<li>We're <s>responsible</s> not responsible for delivering</li>
				</ol>
			</li>
			<li>Logging and error handling</li>
		</ol>
	</section>

	<section class="slide">
			<h2>How it can be</h2>
			<ol>
				<li>Fire event that something happened.</li>
				<li>Serialize event by DTO schema</li>
				<li>Send it to JarvisMessenger rest-service
					<ul>
						<li>Pre-flight data collection from external services if necessary</li>
						<li>Routing to different notification channels (vary vendor/carrier)</li>
						<li>Post-notification internall services (notification to partner/finace team)</li>
					</ul>
				</li>
				<li>Consolidated service health monitor</li>
				<li>Logging and error handling (resend if unreachable, check response code)</li>
			</ol>
	</section>

	<section class="slide">
			<h2>How it may be</h2>
			<ol>
				<li>Fire event that something happened.</li>
				<li>Transform it to JarvisMessenger\MessageQueue and send it to queue</li>
				<li>Consume message from queue
					<ul>
						<li>Pre-flight data collection from external services if necessary</li>
						<li>Routing to different notification channels (vary vendor/carrier)</li>
						<li>Post-notification internall services (notification to partner/finace team)</li>
					</ul>
				</li>
				<li>Service health monitor</li>
				<li>Message queue monitor (don't need to validate response code, monitor entire queue state)</li>
			</ol>
	</section>

	<section class="slide">
		<h2>Let's compare!</h2>
		<table>
			<tr>
				<th scope="col"></th>
				<th>Past</th>
				<th>Present</th>
				<th>Future (REST)</th>
				<th>Fututistic (MQ)</th>
			</tr>
			<tr>
				<th scope="row">Collecting</th>
				<td>Internal</td>
				<td>Internal</td>
				<td>Expandable</td>
				<td>Expandable</td>
			</tr>
			<tr>
				<th scope="row">Presenting</th>
				<td>Twig</td>
				<td>3rd party</td>
				<td>Optional</td>
				<td>Optional</td>
			</tr>
			<tr>
				<th scope="row">Sending object</th>
				<td>SwiftMessage</td>
				<td>EspBundle\Email</td>
				<td>ApiRequest\Email</td>
				<td>MessageQueue</td>
			</tr>
			<tr>
				<th scope="row">Logic/routing</th>
				<td>No</td>
				<td>Not for now</td>
				<td>By design</td>
				<td>By design</td>
			</tr>
			<tr>
				<th scope="row">Logging</th>
				<td>Yes</td>
				<td>Yes</td>
				<td>Service monitor</td>
				<td>Service + queue monitor</td>
			</tr>
			<tr>
				<th scope="row">Error handling</th>
				<td>Internal</td>
				<td>Partially internal</td>
				<td>Partially internal</td>
				<td>99% external</td>
			</tr>
		</table>
	</section>

	<section class="slide">
			<h2>So what are the benefits?</h2>
			<ol>
				<li>One type of domain task - one point of responsibility</li>
				<li>Opportunity to move messaging logic outside</li>
				<li>Easier to diagnose the issues and health state</li>
				<li>In case of message queue implementation - we'll able to get rid of painfull REST error handling</li>
			</ol>
	</section>

	<section class="slide" id="picture">
		<figure>
			<img class="cover" src="pictures/picture.png" alt="The end">
		</figure>
		<style>
			#picture h2 {
				color: white;
			}
		</style>
	</section>

	<footer class="badge">
		<a href="https://github.com/shower/shower">Fork me on GitHub</a>
	</footer>

	<div class="progress"></div>

	<script src="shower/shower.min.js"></script>
	<!-- Copyright © 2018 Yours Truly, Famous Inc. -->

</body>
</html>
